"use strict";

document.addEventListener("DOMContentLoaded", function () {
  getFilms();

  function getFilms() {
    var searchStr = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';
    var apiUrl = 'https://swapi.co/api/films/';
    fetch(apiUrl).then(function (response) {
      return response.json();
    }).then(function (data) {
      var html = '';

      var _loop = function _loop(i) {
        if (searchStr !== '' && searchStr !== undefined) {
          if (data.results[i].title.toLowerCase().indexOf(searchStr.toLowerCase()) < 0) {
            return "continue";
          }
        }

        html += "<div class=\"film\" id=\"film-".concat(i, "\">\n\t\t\t\t\t\t<div class=\"film_img\">\n\t\t\t\t\t\t\t<img src=\"http://placehold.it/260x85?text=Placeholder\" alt=\"").concat(data.results[i].title, "\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"film_desc\">\n\t\t\t\t\t\t\t<h2 class=\"film_title\">").concat(data.results[i].title, "</h2>\n\t\t\t\t\t\t\t<p class=\"film_producer\">").concat(data.results[i].producer, "</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>");
        var apiPhotoUrl = "https://pixabay.com/api/?key=13469464-412b7bcd981b5a6c95e7f09b9&q=".concat(data.results[i].title, "&image_type=photo");
        fetch(apiPhotoUrl).then(function (response) {
          return response.json();
        }).then(function (data) {
          var filmImgSrc;

          if (data.hits.length > 0) {
            filmImgSrc = data.hits[0].webformatURL;
          } else {
            filmImgSrc = 'http://placehold.it/260x85?text=Placeholder';
          }

          document.querySelector("#film-".concat(i, " img")).setAttribute('src', filmImgSrc);
        });
      };

      for (var i = 0; i < data.results.length; i++) {
        var _ret = _loop(i);

        if (_ret === "continue") continue;
      }

      document.querySelector('.films_list').innerHTML = html;
    });
  }

  var searchBtn = document.querySelector('.search_btn');

  if (searchBtn) {
    searchBtn.onclick = function (e) {
      e.preventDefault();
      var searchStr = document.querySelector('#film_input').value;
      $('.films_list .film').fadeOut(200);
      setTimeout(function () {
        return $('.films_list').empty();
      }, 200);
      getFilms(searchStr);
    };
  }

  $('#film_input').keypress(function (e) {
    if (e.which == 13) {
      e.preventDefault();
      return false;
    }
  });
});